# ディレクトリの内容を一覧表示させない
Options -Indexes

# URL書き換え機能を有効にする
RewriteEngine On

# includes ディレクトリへの直接アクセスを禁止する
RewriteRule ^includes/ - [F,L]

# プロフィールURLのリライトルール
# /users/USERNAME を public/profile.php?username=USERNAME に内部的に書き換える
RewriteRule ^users/([^/]+)$ profile.php?username=$1 [L,QSA]

# .php 拡張子をURLから隠すルール
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.*)$ $1.php [L]

# 静的ファイルへのリクエストはリライトしない
RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|svg|ico)$ [NC]
RewriteRule .* - [L] # 何もせず、処理を終了する

# public/ ディレクトリにすべてのアクセスを振り分けるルール
# public/ へのアクセスを既に意図していない場合のみ
RewriteCond %{REQUEST_URI} !^/public/
# リクエストされたものがファイルでもディレクトリでもない場合
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# public/ の中にあるファイルに内部的に書き換える
RewriteRule ^(.*)$ public/$1 [L]
